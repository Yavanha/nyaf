<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../../img/favicon.ico">
  <title>Overview - nyaf Documentation</title>
  <link rel="stylesheet" href="../../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Overview";
    var mkdocs_page_input_path = "md/docs/store/overview.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
<style>
  body, p, pre > code {
    font-size: 1.1em;
  }
  li code {
    font-size: 1.0em;
  }
  code {
    font-size: 1.0em;
    border: none;
    background-color: transparent;
    white-space: pre !important;
  }
  .wy-nav-content { max-width: none; }
  a.toctree-l4 {
    margin-left: 10px;
  }
  blockquote {
    border-left: 5px gray solid;
    background-color: lightgray;
    padding: 10px 10px 1px 10px;
  }
</style>


  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> nyaf Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../../../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../intro/">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../learn/">Learn</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../ts/">Project Configuration (TS)</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../babel/">Project Configuration (JS)</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../config/">Configuration Files</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Core Library</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../lib/overview/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../lib/template/">Template Language</a>
                </li>
                <li class="">
                    
    <a class="" href="../../lib/jsx/">JSX / TSX</a>
                </li>
                <li class="">
                    
    <a class="" href="../../lib/select/">Select Elements</a>
                </li>
                <li class="">
                    
    <a class="" href="../../lib/smart/">Smart Components</a>
                </li>
                <li class="">
                    
    <a class="" href="../../lib/lifecycle/">Life Cycle</a>
                </li>
                <li class="">
                    
    <a class="" href="../../lib/attributes/">Attributes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../lib/directives/">Directives</a>
                </li>
                <li class="">
                    
    <a class="" href="../../lib/events/">Events</a>
                </li>
                <li class="">
                    
    <a class="" href="../../lib/router/">Router</a>
                </li>
                <li class="">
                    
    <a class="" href="../../lib/shadowdom/">Shadow DOM</a>
                </li>
                <li class="">
                    
    <a class="" href="../../lib/services/">Services</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Forms Extension</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../forms/overview/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../forms/vm/">View Models</a>
                </li>
                <li class="">
                    
    <a class="" href="../../forms/nbind/">Data Binding</a>
                </li>
                <li class="">
                    
    <a class="" href="../../forms/validation/">Validation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../forms/custombinders/">Custom Binders</a>
                </li>
                <li class="">
                    
    <a class="" href="../../forms/setup/">Setup</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Flux Store</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Overview</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#the-flux-store">The Flux Store</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#how-it-works">How it works</a></li>
        
            <li><a class="toctree-l4" href="#actions">Actions</a></li>
        
            <li><a class="toctree-l4" href="#reducer">Reducer</a></li>
        
            <li><a class="toctree-l4" href="#store-and-dispatcher">Store and Dispatcher</a></li>
        
            <li><a class="toctree-l4" href="#use-the-store">Use the Store</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../example/">The Store Types</a>
                </li>
                <li class="">
                    
    <a class="" href="../globloc/">Global and Local Stores</a>
                </li>
                <li class="">
                    
    <a class="" href="../dispose/">Disposing Subscriptions</a>
                </li>
                <li class="">
                    
    <a class="" href="../effects/">Effects Mapping</a>
                </li>
                <li class="">
                    
    <a class="" href="../updates/">Automatic Updates</a>
                </li>
                <li class="">
                    
    <a class="" href="../setup/">Setup</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Comparision of @nyaf with...</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../comparision/angular/">...Angular</a>
                </li>
                <li class="">
                    
    <a class="" href="../../comparision/polymer/">...Polymer</a>
                </li>
                <li class="">
                    
    <a class="" href="../../comparision/preact/">...Preact</a>
                </li>
                <li class="">
                    
    <a class="" href="../../comparision/react/">...React</a>
                </li>
                <li class="">
                    
    <a class="" href="../../comparision/stencil/">...Stencil</a>
                </li>
                <li class="">
                    
    <a class="" href="../../comparision/svelte/">...Svelte</a>
                </li>
                <li class="">
                    
    <a class="" href="../../comparision/vue/">...Vue</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Internals</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../internals/about/">About</a>
                </li>
                <li class="">
                    
    <a class="" href="../../internals/lic/">Licence</a>
                </li>
                <li class="">
                    
    <a class="" href="../../internals/start/">How it's being made</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../..">nyaf Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Flux Store &raquo;</li>
        
      
    
    <li>Overview</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/joergkrause/nyaf/edit/master/docs/md/docs/store/overview.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="the-flux-store">The Flux Store<a class="headerlink" href="#the-flux-store" title="Permanent link">#</a></h2>
<p>This module is the store implementation, a simple flux variant without the burden of Redux. It strictly follows the flux pattern and brings, ones fully understood, a great amount of strict programming style to your application. It brings state to your single page app (SPA). Outside of a SPA it's not useful.</p>
<p><img alt="Figure A-7: The flux model" src="assets/flux.png" /></p>
<h3 id="how-it-works">How it works<a class="headerlink" href="#how-it-works" title="Permanent link">#</a></h3>
<p>It's very much like Redux, but makes use of decorators to write less code. It's a good strategy to create one global store in your app. Leave it empty if there are no global actions, but make it global if you have such actions.</p>
<p>Then, define three parts for each implementation:</p>
<ul>
<li><strong>Actions</strong> that the component offers (such as SEARCH, LOAD, SET, REMOVE, you name it)</li>
<li><strong>Reducers</strong> that are pure function calls that do what your business logic requires (change data, call services)</li>
<li>A <strong>State</strong> Object that holds all the data. The reducer can change the state, but nobody else can</li>
</ul>
<p>In the component you have two tasks:</p>
<ol>
<li>Dispatch actions and add payload if required.</li>
<li>Listen for changes in the store to know when an reducer finished it's task.</li>
</ol>
<p>An async load must not be split-up. The calls are async, hence the state change may appear later, but nonetheless it lands in the component eventually.</p>
<h3 id="actions">Actions<a class="headerlink" href="#actions" title="Permanent link">#</a></h3>
<p>Define the capabilities of your app, along with some default or initial value. In this example I use <code>Symbol</code> to define unique constants that are being used for any further request of an action.</p>
<pre><code class="ts">export const INC = Symbol('INC');
export const DEC = Symbol('DEC');
export const SET = Symbol('SET');

export default {
  // initial value of payload,
  // this can be omitted if you don't care
  [INC]: () =&gt; 1,
  [DEC]: () =&gt; -1,
  SET
};
</code></pre>

<p>The following figure shows the relevant parts of the action definition:</p>
<p><img alt="Figure A-8: The main parts store: the action setup" src="assets/actions.png" /></p>
<blockquote>
<p><strong>Why using actions?</strong> It's convenient to have typed constants in the editor and use easy to remember names without the chance to create mistakenly typos.</p>
</blockquote>
<h3 id="reducer">Reducer<a class="headerlink" href="#reducer" title="Permanent link">#</a></h3>
<p>Define, what happens if an action is being dispatched:</p>
<pre><code class="ts">import { INC, DEC } from '../actions/counter.action';
import stateType from '../states/counter.state';

export default {
    [INC]: (state: stateType, payload: number) =&gt; {
      state.counter = state.counter + payload;
      return state;
    },
    [DEC]: (state: stateType, payload: number) =&gt; {
      state.counter = state.counter - payload;
      return state;
    }
};
</code></pre>

<p>The following figure shows the relevant parts of the reducer definition:</p>
<p><img alt="Figure A-9: Parts of a reducer" src="assets/reducer.png" /></p>
<p>The returned payload is the whole store object by reference. The type for the store is optional and helps elevating the power of TypeScript and getting a type safe store.</p>
<blockquote>
<p><strong>Why using reducers at all?</strong> Pure function calls are the foundation of a side effect free business layer. You have exactly one location where the logic goes -  the reducer. That's said, from now on you will know where to have logic, where to have UI, and where to store everything.</p>
</blockquote>
<p>Reducers can be sync or async, every function can be made as you like.</p>
<h4 id="return-value-considerations">Return Value Considerations<a class="headerlink" href="#return-value-considerations" title="Permanent link">#</a></h4>
<p>The return value is an object that contains the fragments of the store that need to be changed. Through subscriptions this is the way to inform other instances that something happened. But be careful with setting multiple values in one single step. The store logic will execute property by property and immediately publish the change event. A subscriber will receive the changes in the exact order of the properties in the reducers returns value. If the subscriber receives the first property's change event, the ne value is provided. However, the remaining values are not yet set, and hence the store is in an intermediate state. You must wait for all subscribers to get their final values. The best way to avoid hassle here is to avoid returning multiple values from a single reducer function.</p>
<h3 id="store-and-dispatcher">Store and Dispatcher<a class="headerlink" href="#store-and-dispatcher" title="Permanent link">#</a></h3>
<p>The store holds the state, provides a dispatch function and fires events in case a store value changes. First, the store can by defined by types, but this is an option and you may decide to go with a simple object just for the sake of simplicity.</p>
<p><img alt="Figure A-10: The store's parts" src="assets/store.png" /></p>
<p>The example shows a store that consists of fragments. This allows one to use parts of the store just by using the type fragments.</p>
<pre><code class="ts">// This is a store fragment
export interface DemoTitleStore {
  title: string;
}
// This is a store fragment
export interface CounterStore {
  counter: number;
}
// This is the complete store, which can be used complete or in fragments
type store = CounterStore &amp; DemoTitleStore;
// This is for convenient access
export default store;
</code></pre>

<p>Now see the usage within a component. First, you must configure the store with the elements written before. As shown it's easy to combine reducers and add the various actions. To have the state typed a generic is being used.</p>
<pre><code class="ts">import counterReducer from '../reducer/counter.reducer';
import setReducer from '../reducer/set.reducer';
import counterActions from '../actions/counter.action';
import storeStateType from '../states/counter.state';

const store = new Store&lt;storeStateType&gt;({
  actions: counterActions,
  mutations: { ...counterReducer, ...setReducer  },
  state: { counter: 0 }
});
</code></pre>

<h3 id="use-the-store">Use the Store<a class="headerlink" href="#use-the-store" title="Permanent link">#</a></h3>
<p>Now make the <em>store</em> constant available in the component, if it's not yet defined there. This particular store can handle just one single component or spread multiple components and form eventually a single source of truth for the whole application.</p>
<pre><code class="tsx">@CustomElement('app-store-counter')
@ProvideStore&lt;storeStateType&gt;(store)
export class StoreCounterComponent
       extends BaseComponent&lt;{ cnt: number }&gt;
       implements IStore&lt;storeStateType&gt; {

  constructor() {
    super();
    this.setData('cnt', 0);
    // fire if a value changes in the store,
    // takes name of the store value
    this.store.subscribe('counter', str =&gt; {
      // write to a observed property to force re-render
      this.data.cnt = str.counter;
    });
  }

  clickMeAdd(e) {
    console.log('Counter Element Click INC');
    this.store.dispatch(INC, 1);
  }

  clickMeSub(e) {
    console.log('Counter Element Click DEC');
    this.store.dispatch(DEC, 1);
  }

  clickMeSet(e) {
    console.log('Counter Element Click SET');
    this.store.dispatch(SET, 100);
  }

  render() {
    return (
      &lt;&gt;
        &lt;div&gt;
          &lt;button type='button' n-on-click={this.clickMeAdd}&gt;
            Add 1
          &lt;/button&gt;
          &lt;button type='button' n-on-click={this.clickMeSub}&gt;
            Sub 1
          &lt;/button&gt;
          &lt;button type='button' n-on-click={this.clickMeSet}&gt;
            Set 100
          &lt;/button&gt;
        &lt;/div&gt;
        &lt;pre style='border: 1px solid gray;'&gt;{this.data.cnt}&lt;/pre&gt;
      &lt;/&gt;
    );
  }
}
</code></pre>

<p>The decorator <code>@ProvideStore&lt;T&gt;(storeInstance)</code> in the example activates the store and creates an instance in the property <em>this.store</em>. To help TypeScript to understand the existence of this property you must implement the interface <code>IStore&lt;T&gt;</code> with the same type as used in the decorator. Now you have access and an already existing instance. The store gives you access to the two main features, dispatching actions and subscribing to changes.</p>
<blockquote>
<p><strong>Pro Tip!</strong> Combine this example with the forms module (<strong>@nyaf/forms</strong>) and get binding on element level using the <code>n-bind</code> template feature.</p>
</blockquote>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../example/" class="btn btn-neutral float-right" title="The Store Types">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../forms/setup/" class="btn btn-neutral" title="Setup"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/joergkrause/nyaf/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../forms/setup/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../example/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../../..';</script>
    <script src="../../../../js/theme.js" defer></script>
      <script src="../../../../search/main.js" defer></script>

</body>
</html>
